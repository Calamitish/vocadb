@using VocaDb.Model.DataContracts.Users
@using VocaDb.Model.Utils
@using VocaDb.Web.Helpers
@using VocaDb.Web.Resources.Domain
@inherits VocaDb.Web.Code.VocaDbPage

@{
	var searchObjectType = PageProperties.GlobalSearchType;
}

<!-- Common scripts -->
<remikus path="/bundles/manifest.js" />
<remikus path="/bundles/vendor.js" />
<remikus path="/bundles/shared/libs.js" />
<remikus path="/bundles/VocaDB.js" />
<remikus path="/bundles/vdb.js" />

<script type="text/javascript">
	vdb = vdb || {};
	vdb.values = @ToJS(new
	{
		LockdownMessage = AppConfig.LockdownMessage,
		BaseAddress = RootPath,
		LanguagePreference = (int)Login.Manager.LanguagePreference,
		IsLoggedIn = UserContext.IsLoggedIn,
		LoggedUserId = UserContext.LoggedUserId,
		Culture = Culture,
		UICulture = UICulture,
		LoggedUser = Login.User is ServerOnlyUserWithPermissionsContract loggedUser ? new
		{
			Id = loggedUser.Id,
			Name = loggedUser.Name,
			Active = loggedUser.Active,
			EffectivePermissions = loggedUser.EffectivePermissions.Select(p => p.Id).ToArray(),
		} : null,
	});
	vdb.resources = vdb.resources || {};

	var model = {
		entryTypeTranslations: @ResourceHelpers.ToJSON(EntryTypeNames.ResourceManager),
		getNewReportCount: @ToJS(Login.CanManageEntryReports),
		hasUnreadMessages: @ToJS(Login.Manager.IsLoggedIn && Login.User.UnreadMessagesCount > 0),
		reportSent: @ToJS(AjaxRes.SharedStrings.ReportSent),
		rootPath: '@RootPath',
		thanksForRating: @ToJS(AjaxRes.SharedStrings.ThanksForRating),
		topBarData: @Html.Raw(JsonHelpers.Serialize(new {
			searchObjectType = searchObjectType.ToString()
		})),
		unreadMessagesCount: @(Login.Manager.IsLoggedIn ? Login.User.UnreadMessagesCount : 0),
	};
	app.SharedLayoutScripts(model);
</script>
